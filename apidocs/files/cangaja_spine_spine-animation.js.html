<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>cangaja&#x2F;spine&#x2F;spine-animation.js - Cangaja API</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="Cangaja API"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/CG.Animation.html">CG.Animation</a></li>
            
                <li><a href="..&#x2F;classes/CG.AtlasImage.html">CG.AtlasImage</a></li>
            
                <li><a href="..&#x2F;classes/CG.AtlasTexturePacker.html">CG.AtlasTexturePacker</a></li>
            
                <li><a href="..&#x2F;classes/CG.B2DBridge.html">CG.B2DBridge</a></li>
            
                <li><a href="..&#x2F;classes/CG.B2DChainShape.html">CG.B2DChainShape</a></li>
            
                <li><a href="..&#x2F;classes/CG.B2DCirlce.html">CG.B2DCirlce</a></li>
            
                <li><a href="..&#x2F;classes/CG.B2DEntity.html">CG.B2DEntity</a></li>
            
                <li><a href="..&#x2F;classes/CG.B2DLine.html">CG.B2DLine</a></li>
            
                <li><a href="..&#x2F;classes/CG.B2DPolygon.html">CG.B2DPolygon</a></li>
            
                <li><a href="..&#x2F;classes/CG.B2DRectangle.html">CG.B2DRectangle</a></li>
            
                <li><a href="..&#x2F;classes/CG.B2DRope.html">CG.B2DRope</a></li>
            
                <li><a href="..&#x2F;classes/CG.B2DTerrain.html">CG.B2DTerrain</a></li>
            
                <li><a href="..&#x2F;classes/CG.B2DWorld.html">CG.B2DWorld</a></li>
            
                <li><a href="..&#x2F;classes/CG.Bitmap.html">CG.Bitmap</a></li>
            
                <li><a href="..&#x2F;classes/CG.Bound.html">CG.Bound</a></li>
            
                <li><a href="..&#x2F;classes/CG.Buffer.html">CG.Buffer</a></li>
            
                <li><a href="..&#x2F;classes/CG.Button.html">CG.Button</a></li>
            
                <li><a href="..&#x2F;classes/CG.CanvasRenderer.html">CG.CanvasRenderer</a></li>
            
                <li><a href="..&#x2F;classes/CG.Delta.html">CG.Delta</a></li>
            
                <li><a href="..&#x2F;classes/CG.Director.html">CG.Director</a></li>
            
                <li><a href="..&#x2F;classes/CG.Emitter.html">CG.Emitter</a></li>
            
                <li><a href="..&#x2F;classes/CG.Entity.html">CG.Entity</a></li>
            
                <li><a href="..&#x2F;classes/CG.Font.html">CG.Font</a></li>
            
                <li><a href="..&#x2F;classes/CG.Layer.html">CG.Layer</a></li>
            
                <li><a href="..&#x2F;classes/CG.Map.html">CG.Map</a></li>
            
                <li><a href="..&#x2F;classes/CG.MapArea.html">CG.MapArea</a></li>
            
                <li><a href="..&#x2F;classes/CG.MapPoint.html">CG.MapPoint</a></li>
            
                <li><a href="..&#x2F;classes/CG.MapTileLayer.html">CG.MapTileLayer</a></li>
            
                <li><a href="..&#x2F;classes/CG.MapTileProperties.html">CG.MapTileProperties</a></li>
            
                <li><a href="..&#x2F;classes/CG.MediaAsset.html">CG.MediaAsset</a></li>
            
                <li><a href="..&#x2F;classes/CG.Menu.html">CG.Menu</a></li>
            
                <li><a href="..&#x2F;classes/CG.Morph.html">CG.Morph</a></li>
            
                <li><a href="..&#x2F;classes/CG.Particle.html">CG.Particle</a></li>
            
                <li><a href="..&#x2F;classes/CG.Point.html">CG.Point</a></li>
            
                <li><a href="..&#x2F;classes/CG.Rectangle.html">CG.Rectangle</a></li>
            
                <li><a href="..&#x2F;classes/CG.Screen.html">CG.Screen</a></li>
            
                <li><a href="..&#x2F;classes/CG.Sequence.html">CG.Sequence</a></li>
            
                <li><a href="..&#x2F;classes/CG.SpineAnimation.html">CG.SpineAnimation</a></li>
            
                <li><a href="..&#x2F;classes/CG.Sprite.html">CG.Sprite</a></li>
            
                <li><a href="..&#x2F;classes/CG.Text.html">CG.Text</a></li>
            
                <li><a href="..&#x2F;classes/CG.Translate.html">CG.Translate</a></li>
            
                <li><a href="..&#x2F;classes/CG.Vector.html">CG.Vector</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/CG.html">CG</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: cangaja&#x2F;spine&#x2F;spine-animation.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
 * @description
 *
 * CG.SpineAnimation
 *
 * @class CG.SpineAnimation
 * @extends CG.Entity
 *
 *
 * TODO
 * Boundingbox collision see example here:
 * https:&#x2F;&#x2F;github.com&#x2F;EsotericSoftware&#x2F;spine-runtimes&#x2F;blob&#x2F;master&#x2F;spine-libgdx&#x2F;test&#x2F;com&#x2F;esotericsoftware&#x2F;spine&#x2F;AnimationStateTest.java
 *
 *
 * Eventhandler see example here:
 * https:&#x2F;&#x2F;github.com&#x2F;EsotericSoftware&#x2F;spine-runtimes&#x2F;blob&#x2F;master&#x2F;spine-libgdx&#x2F;test&#x2F;com&#x2F;esotericsoftware&#x2F;spine&#x2F;SkeletonTest.java
 *
 *
 * Box2d support see example here:
 * https:&#x2F;&#x2F;github.com&#x2F;EsotericSoftware&#x2F;spine-runtimes&#x2F;blob&#x2F;master&#x2F;spine-libgdx&#x2F;test&#x2F;com&#x2F;esotericsoftware&#x2F;spine&#x2F;Box2DExample.java
 * http:&#x2F;&#x2F;www.esotericsoftware.com&#x2F;forum&#x2F;viewtopic.php?f=3&amp;t=1394&amp;p=6691&amp;hilit=skeletonbounds#p6691
 *&#x2F;
CG.Entity.extend(&#x27;SpineAnimation&#x27;, {
    &#x2F;**
     * @constructor
     * @method init
     * @param spinejson     Spine json animation file
     * @param spineatlas    Spine
     * @param position
     * @param scale
     * @param callback callback function
     *&#x2F;
    init: function (spinejson, spineatlas, position, scale, callback) {
        this._super(&#x27;&#x27;)

        self = this

        this.instanceOf = &#x27;SpineAnimation&#x27;

        this.lastTime = Date.now()

        this.skeletonposition = position || new CG.Point(0, 0)

        this.xscale = 1

        this.yscale = 1

        this.scale = scale || 1

        this.vertices = []

        this.atlasimage = true

        this.textures = []

        this.textureCount = 0

        if (spineatlas.type == &#x27;text&#x27;) {
            this.spineAtlasData = spineatlas.data   &#x2F;&#x2F;text data from mediaasset object
            console.log(&#x27;spine atlas: text (libGDX) used&#x27;)
        } else if (spineatlas.type == &#x27;json&#x27;) {
            this.spineAtlasData = spineatlas.src    &#x2F;&#x2F;pure json text for spine atlas loader?
            console.log(&#x27;spine atlas: json&#x27;)
            throw &#x27;json format is not supported by spine-js runtime?&#x27;
        } else {
            throw &#x27;check your atlas file format?&#x27;
        }

        this.spineJsonData = spinejson.data &#x2F;&#x2F;parsed json data from mediaasset object

        this.initCustom = callback

        this.spineAtlas = new spine.Atlas(this.spineAtlasData, {
            load: function (page, path) {
                this.textureCount++
                var image = new Image()
                image.onload = function () {
                    page.rendererObject = image
                    page.width = image.width
                    page.height = image.height
                    self.spineAtlas.updateUVs(page)
                    this.textureCount--
                }
                image.onerror = function () {
                    throw &quot;error: atlas image not loaded! &quot; + path
                }
                image.src = &#x27;media&#x2F;spine&#x2F;&#x27; + path
            },
            unload: function (texture) {
            }
        });

        this.waitForTextures();
    },
    waitForTextures: function () {
        if (!this.textureCount) {
            this.initSkeleton()
        } else {
            setTimeout(this.waitForTextures, 100)
        }
    },
    initSkeleton: function () {

        this.skeletonJson = new spine.SkeletonJson(new spine.AtlasAttachmentLoader(self.spineAtlas))
        this.skeletonJson.scale = this.scale    &#x2F;&#x2F;experimental scale

        if (typeof this.spineJsonData === &#x27;object&#x27;) {
            this.skeletonData = this.skeletonJson.readSkeletonData(this.spineJsonData)
        } else {
            this.skeletonData = this.skeletonJson.readSkeletonData(JSON.parse(this.spineJsonData))
        }

        spine.Bone.yDown = true

        this.skeleton = new spine.Skeleton(this.skeletonData)

        this.skeleton.getRootBone().x = this.skeletonposition.x || 0
        this.skeleton.getRootBone().y = this.skeletonposition.y || 0   &#x2F;&#x2F;has spine a another origin (bottom left) than the canvas on y axis?

        this.skeleton.updateWorldTransform()

        this.stateData = new spine.AnimationStateData(this.skeletonData)
        this.state = new spine.AnimationState(this.stateData)

        &#x2F;&#x2F;callback for custom initialization?
        this.initCustom(this)

        this.state.onEvent = function (trackIndex, event) {
            &#x2F;&#x2F; alert(trackIndex + &quot; event: &quot; + event.data.name)
        }
    },
    update: function () {

        var dt = (Date.now() - this.lastTime) &#x2F; 1000
        this.lastTime = Date.now()

        this.state.update(dt)    &#x2F;&#x2F; delta
        this.state.apply(this.skeleton)
        this.skeleton.updateWorldTransform()
    },
    draw: function () {
        var drawOrder = this.skeleton.drawOrder
        for (var i = 0, n = drawOrder.length; i &lt; n; i++) {
            var slot = drawOrder[i]
            var attachment = slot.attachment
            var bone = slot.bone
            if (!(attachment instanceof spine.RegionAttachment)) continue
            attachment.computeVertices(this.skeleton.x, this.skeleton.y, slot.bone, this.vertices)

            try {
                this.alpha = slot.a &#x2F;&#x2F;get alphe value from slot
                this.position = new CG.Point(this.vertices[2], this.vertices[3])
                this.xoffset = attachment.rendererObject.x
                this.yoffset = attachment.rendererObject.y
                this.cutwidth = attachment.width
                this.cutheight = attachment.height
                this.xscale = bone.worldScaleX &#x2F;&#x2F;* this.scale
                this.yscale = bone.worldScaleY &#x2F;&#x2F;* this.scale
                this.xhandle = this.cutwidth &#x2F; 2 * this.xscale
                this.yhandle = this.cutheight &#x2F; 2 * this.yscale
                this.rotation = -(bone.worldRotation + attachment.rotation)
                this.xpos = 0
                this.ypos = 0

                if (this.skeleton.flipX) {

                    this.xscale *= -1
                    this.xpos = this.cutwidth
                    this.rotation *= -1
                }

                if (this.skeleton.flipY) {

                    this.yscale *= -1
                    this.ypos = this.cutheight
                    this.rotation *= -1
                }
                this.imagerotation = 0

                this.image = attachment.rendererObject.page.rendererObject
                this.width = attachment.rendererObject.page.rendererObject.width
                this.height = attachment.rendererObject.page.rendererObject.height

                Game.renderer.draw(this)

            } catch (e) {
&#x2F;&#x2F;                console.log(e)
&#x2F;&#x2F;                console.log(attachment)
            }

        }


    },
    updateDiff: function () {

    }
})



    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
